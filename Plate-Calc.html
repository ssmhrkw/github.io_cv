<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acoustic & Vibration Properties of Plates - Final Version</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body { font-family: 'Segoe UI', Meiryo, sans-serif; margin: 0; padding: 10px; font-size: 14px; background-color: #f4f4f4; display: flex; flex-direction: column; gap: 15px; }
        .input-column, .output-column { display: flex; flex-direction: column; gap: 15px; width: 100%; }
        fieldset { border: 1px solid #ccc; border-radius: 5px; padding: 15px; background-color: #fff; margin: 0; }
        legend { font-weight: bold; padding: 0 5px; }
        .form-grid { display: grid; grid-template-columns: 140px 1fr 40px; align-items: center; gap: 8px; }
        .form-grid-condensed { display: grid; grid-template-columns: 140px 1fr; align-items: center; gap: 8px; }
        label { font-size: 14px; }
        input, select { width: 100%; padding: 8px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 3px; }
        button.calc-btn-tab { width: auto; padding: 8px 20px; float: right; margin-top: 10px; background-color: #5cb85c; color: white; border-color: #4cae4c; border-radius: 4px; }
        .tabs { display: flex; flex-wrap: wrap; border-bottom: 1px solid #ccc; }
        .tab-button { padding: 10px 15px; cursor: pointer; background: #f1f1f1; border: 1px solid #ccc; border-bottom: none; border-radius: 5px 5px 0 0; margin-bottom: -1px; }
        .tab-button.active { background: #fff; border-bottom: 1px solid #fff; }
        .tab-content { display: none; padding: 15px; border: 1px solid #ccc; border-top: none; clear: both; }
        .tab-content.active { display: block; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: right; }
        th { background-color: #f2f2f2; text-align: center; }
        .chart-wrapper { position: relative; width: 100%; }
        .formula-container { margin-top: 20px; padding: 15px; background-color: #fafafa; border: 1px solid #eee; border-radius: 5px; font-size: 13px; }
        .formula-container h5 { margin-top: 0; margin-bottom: 10px; font-size: 1.1em; border-bottom: 1px solid #ddd; padding-bottom: 5px; }

        @media (min-width: 900px) {
            body { flex-direction: row; align-items: flex-start; }
            .input-column { width: 420px; min-width: 420px; }
            .output-column { flex-grow: 1; }
            .chart-wrapper { height: 400px; }
        }
    </style>
</head>
<body>

    <div class="input-column">
        <fieldset><legend>Common Input Conditions</legend>
            <div class="form-grid"><label for="material-select">Material:</label><select id="material-select"></select><span></span><label for="thick-input">Thickness (h):</label><input type="number" id="thick-input" value="12.0"><span>mm</span><label for="lx-input">Length (Lx):</label><input type="number" id="lx-input" value="1000"><span>mm</span><label for="ly-input">Width (Ly):</label><input type="number" id="ly-input" value="1000"><span>mm</span></div>
        </fieldset>
        <fieldset><legend>Material Properties (Editable)</legend>
            <div class="form-grid"><label for="e-input">Young's Modulus (E):</label><input type="text" id="e-input"><span>Pa</span><label for="rho-input">Density (ρ):</label><input type="text" id="rho-input"><span>kg/m³</span><label for="nu-input">Poisson's Ratio (ν):</label><input type="text" id="nu-input"><span></span></div>
        </fieldset>
        <fieldset><legend>Advanced Conditions</legend>
            <div class="form-grid-condensed">
                <label for="baffle-cond">Baffle Condition:</label><select id="baffle-cond"><option value="1">In-plane</option><option value="2">Rigid</option></select>
            </div>
        </fieldset>
        <fieldset><legend>Driving-Point Impedance</legend>
            <div class="form-grid-condensed">
                <label>Position X (mm):</label><input type="number" id="pos-x" value="500">
                <label>Position Y (mm):</label><input type="number" id="pos-y" value="500">
            </div>
        </fieldset>
    </div>

    <div class="output-column">
        <div class="tabs">
            <button class="tab-button active" onclick="openTab(event, 'basic-tab')">Basic Properties</button>
            <button class="tab-button" onclick="openTab(event, 'natural-freq-tab')">Natural Frequencies</button>
            <button class="tab-button" onclick="openTab(event, 'impedance-tab')">Impedance</button>
            <button class="tab-button" onclick="openTab(event, 'stl-tab')">Sound Transmission Loss (STL)</button>
            <button class="tab-button" onclick="openTab(event, 'rad-tab')">Radiation Efficiency (σ)</button>
        </div>

        <div id="basic-tab" class="tab-content active"><table id="basic-results-table"></table><div id="basic-formula" class="formula-container"></div><button class="calc-btn-tab" onclick="calculateBasic()">Calculate</button></div>
        <div id="natural-freq-tab" class="tab-content"><table id="natural-freq-table"></table><div id="natural-freq-formula" class="formula-container"></div><button class="calc-btn-tab" onclick="calculateNaturalFreq()">Calculate</button></div>
        <div id="impedance-tab" class="tab-content"><div class="chart-wrapper"><canvas id="impedance-chart"></canvas></div><div style="max-height: 200px; overflow-y: auto; margin-top: 10px;"><table id="impedance-table"></table></div><hr><table id="inf-impedance-table"></table><div id="impedance-formula" class="formula-container"></div><button class="calc-btn-tab" onclick="calculateImpedance()">Calculate</button></div>
        <div id="stl-tab" class="tab-content"><div class="chart-wrapper"><canvas id="stl-chart"></canvas></div><div style="max-height: 200px; overflow-y: auto; margin-top: 10px;"><table id="stl-table"></table></div><div id="stl-formula" class="formula-container"></div><button class="calc-btn-tab" onclick="calculateSTL()">Calculate</button></div>
        <div id="rad-tab" class="tab-content"><div class="chart-wrapper"><canvas id="rad-chart"></canvas></div><div style="max-height: 200px; overflow-y: auto; margin-top: 10px;"><table id="rad-table"></table></div><div id="rad-formula" class="formula-container"></div><button class="calc-btn-tab" onclick="calculateRadiation()">Calculate</button></div>
    </div>

<script>
    const MATERIAL_PROPERTIES = { "Custom": { "rho": 0, "E": 0, "nu": 0 }, "Concrete": { "rho": 2.3e3, "E": 2.1e10, "nu": 0.005 }, "Lightweight Concrete": { "rho": 1.5e3, "E": 0.5e10, "nu": 0.005 }, "Aerated Concrete": { "rho": 0.6e3, "E": 0.16e10, "nu": 0.005 }, "Gypsum Board": { "rho": 0.8e3, "E": 0.18e10, "nu": 0.005 }, "Reinforced Gypsum Board": { "rho": 1.1e3, "E": 0.2e10, "nu": 0.005 }, "Flexible Board": { "rho": 1.9e3, "E": 0.2e10, "nu": 0.005 }, "Hardboard": { "rho": 0.9e3, "E": 0.6e10, "nu": 0.005 }, "Plywood": { "rho": 0.6e3, "E": 0.5e10, "nu": 0.30 }, "Cork": { "rho": 0.25e3, "E": 6e7, "nu": 0.30 }, "Glass": { "rho": 2500, "E": 70.0e9, "nu": 0.23 }, "Hard PVC": { "rho": 1.4e3, "E": 0.35e10, "nu": 0.012 }, "Rubber (Hardness 50)": { "rho": 1.11e3, "E": 0.46e7, "nu": 0.1 } };
    const FREQS = [16, 20, 25, 31.5, 40, 50, 63, 80, 100, 125, 160, 200, 250, 315, 400, 500, 630, 800, 1000, 1250, 1600, 2000, 2500, 3150, 4000, 5000, 6300, 8000];
    const THIRD_OCTAVE_TICKS = [16, 31.5, 63, 125, 250, 500, 1000, 2000, 4000, 8000];
    let charts = {};
    const ui = {
        materialSelect: document.getElementById('material-select'), thickInput: document.getElementById('thick-input'), lxInput: document.getElementById('lx-input'), lyInput: document.getElementById('ly-input'), etaInput: document.getElementById('eta-input'), eInput: document.getElementById('e-input'), rhoInput: document.getElementById('rho-input'), nuInput: document.getElementById('nu-input'),
        baffleCond: document.getElementById('baffle-cond'), posX: document.getElementById('pos-x'), posY: document.getElementById('pos-y'),
        basicTable: document.getElementById('basic-results-table'), naturalFreqTable: document.getElementById('natural-freq-table'),
        infImpedanceTable: document.getElementById('inf-impedance-table'), impedanceTable: document.getElementById('impedance-table'),
        stlTable: document.getElementById('stl-table'), radTable: document.getElementById('rad-table'),
    };
    class Complex { constructor(re=0, im=0) { this.re=re; this.im=im; } add(z) { return new Complex(this.re+z.re, this.im+z.im); } sub(z) { return new Complex(this.re-z.re, this.im-z.im); } mul(z) { return new Complex(this.re*z.re - this.im*z.im, this.re*z.im + this.im*z.re); } div(z) { const d=z.re*z.re+z.im*z.im; if(d===0) return new Complex(Infinity, Infinity); return new Complex((this.re*z.re+this.im*z.im)/d, (this.im*z.re-this.re*z.im)/d); } get magnitude() { return Math.sqrt(this.re*this.re+this.im*this.im); } get phase() { return Math.atan2(this.im, this.re); } static i() { return new Complex(0, 1); } }

    document.addEventListener('DOMContentLoaded', () => {
        for (const name in MATERIAL_PROPERTIES) { ui.materialSelect.add(new Option(name, name)); }
        ui.materialSelect.value = "Gypsum Board";
        ui.materialSelect.addEventListener('change', onMaterialSelect);
        onMaterialSelect();
        calculateAllTabs();
    });

    function calculateAllTabs(){
        try {
            calculateBasic(); 
            calculateNaturalFreq(); 
            calculateImpedance(); 
            calculateSTL(); 
            calculateRadiation();
        } catch (e) {
            alert(e.message);
        }
    }

    function getCommonInputs() {
        const h=parseFloat(ui.thickInput.value)/1000, E=parseFloat(ui.eInput.value), rho=parseFloat(ui.rhoInput.value), nu=parseFloat(ui.nuInput.value);
        if (h<=0||E<=0||rho<=0) { throw new Error("Thickness, Young's Modulus, and Density must be positive."); }
        const Lx=parseFloat(ui.lxInput.value)/1000, Ly=parseFloat(ui.lyInput.value)/1000;
        if (Lx <= 0 || Ly <= 0) { throw new Error("Plate length and width must be positive.");}
        const c0=343.0, D=(E*h**3)/(12*(1-nu**2)), fc=(c0**2/(2*Math.PI*h))*Math.sqrt(12*rho*(1-nu**2)/E);
        return { h, E, rho, nu, Lx, Ly, c0, D, fc };
    }
    
    function calculateBasic() { try { const { h, E, rho, nu, D, fc, Lx, Ly } = getCommonInputs(); const C_L_p = Math.sqrt(E / (rho * (1 - nu**2))); const S = Lx * Ly; const mode_density = (S > 0 && h > 0 && C_L_p > 0) ? (S * Math.sqrt(3)) / (h * C_L_p) : 0; createTable(ui.basicTable, ["Property", "Value", "Unit"], [["Bending Stiffness (D)", D.toExponential(2), "N·m"],["Critical Frequency (Fc)", fc.toFixed(2), "Hz"],["Longitudinal Plate Wave Speed (C_L,p)", C_L_p.toFixed(2), "m/s"],["Mode Density (n(f))", mode_density.toFixed(3), "modes/Hz"]]); document.getElementById('basic-formula').innerHTML = `<h5>Equations for Basic Properties</h5><p><b>Bending Stiffness (D):</b> $$ D = \\frac{E h^3}{12(1-\\nu^2)} $$</p><p><b>Longitudinal Plate Wave Speed (c<sub>L,p</sub>):</b> $$ c_{L,p} = \\sqrt{\\frac{E}{\\rho(1-\\nu^2)}} $$</p><p><b>Critical Frequency (f<sub>c</sub>):</b> $$ f_c = \\frac{c_0^2 \\sqrt{3}}{\\pi h c_{L,p}} $$</p><p><b>Mode Density (n(f)):</b> $$ n(f) = \\frac{S \\sqrt{3}}{h c_{L,p}} $$</p>`; if(window.MathJax) MathJax.typeset(); } catch (e) { alert(e.message); } }
    
    function calculateNaturalFreq() {
        try {
            const { rho, h, D, Lx, Ly } = getCommonInputs();
            let results = [];
            document.getElementById('natural-freq-formula').innerHTML = `<h5>Natural Frequencies (Simply Supported)</h5><p>$$ f_{m,n} = \\frac{\\pi}{2} \\sqrt{\\frac{D}{\\rho h}} \\left( \\left(\\frac{m}{L_x}\\right)^2 + \\left(\\frac{n}{L_y}\\right)^2 \\right) $$</p>`;
            if (Lx > 0 && Ly > 0) {
                for (let m = 1; m <= 5; m++) { for (let n = 1; n <= 5; n++) {
                    const f_mn = (Math.PI / 2) * Math.sqrt(D / (rho * h)) * ((m / Lx)**2 + (n / Ly)**2);
                    results.push([`f(${m},${n})`, f_mn.toFixed(2)]);
                }}
            }
            createTable(ui.naturalFreqTable, ["Mode (m,n)", "Frequency (Hz)"], results);
            if(window.MathJax) MathJax.typeset();
        } catch (e) { alert(e.message); }
    }
    
    function calculateImpedance() {
        try {
            const { E, rho, h, D, Lx, Ly, nu } = getCommonInputs();
            const posX = parseFloat(ui.posX.value) / 1000, posY = parseFloat(ui.posY.value) / 1000;
            const S = Lx * Ly, rho_s = rho * h;
            const C_L = Math.sqrt(E/rho);
    
            const Z_inf_ref = 2.3 * rho * C_L * h**2;
    
            // 無限板インピーダンス（基準値）
            createTable(
                ui.infImpedanceTable,
                ["Property", "Value"],
                [["Infinite Plate Impedance (Z_inf, ref)", `${Z_inf_ref.toExponential(2)} Ns/m³`]]
            );
    
            let results = { mag_dB: [], real: [], phase: [] };
            let tableData = [];
    
            for (const f of FREQS) {
                const omega = 2 * Math.PI * f;
                const eta_f = 0.005 + 0.3 / Math.sqrt(f);
    
                let Y_sum = new Complex();
                for (let p = 1; p <= 5; p++) {
                    for (let q = 1; q <= 5; q++) {
                        const C_L_p = Math.sqrt(E / (rho * (1-nu**2)));
                        const f_pq = (Math.PI * C_L_p * h / (2 * Math.sqrt(3))) * ((p / Lx) ** 2 + (q / Ly) ** 2);
                        const omega_pq = 2 * Math.PI * f_pq;
                        const psi_pq = Math.sin(p * Math.PI * posX / Lx) * Math.sin(q * Math.PI * posY / Ly);
                        const denominator = (new Complex(omega_pq ** 2, omega_pq ** 2 * eta_f)).sub(new Complex(omega ** 2, 0));
                        Y_sum = Y_sum.add((new Complex(psi_pq ** 2, 0)).div(denominator));
                    }
                }
                const Y_dp = (Complex.i().mul(new Complex(4 * omega / rho_s, 0))).div(new Complex(S, 0)).mul(Y_sum);
                const Z_dp = (new Complex(1, 0)).div(Y_dp);
    
                // magnitude in dB, real part, phase
                const mag = isFinite(Z_dp.magnitude) ? 20 * Math.log10(Z_dp.magnitude) : null;
                const re = isFinite(Z_dp.real) ? Z_dp.real : null;
                const phase = isFinite(Z_dp.phase) ? (Z_dp.phase * 180 / Math.PI) : null; // [deg]
    
                results.mag_dB.push(mag);
                results.real.push(re);
                results.phase.push(phase);
    
                tableData.push([
                    f,
                    mag !== null ? mag.toFixed(2) : 'NaN',
                    re !== null ? re.toExponential(2) : 'NaN',
                    phase !== null ? phase.toFixed(1) : 'NaN'
                ]);
            }
    
            // === Plot ===
            createPlot('impedance-chart', FREQS, [
                { label: '|Z| [dB re 1 Ns/m³]', data: results.mag_dB, borderColor: 'rgba(255, 99, 132, 1)', yAxisID: 'y' },
                { label: 'Re(Z)', data: results.real, borderColor: 'rgba(54, 162, 235, 1)', yAxisID: 'y1' },
                { label: 'Phase(Z) [deg]', data: results.phase, borderColor: 'rgba(255, 206, 86, 1)', yAxisID: 'y2' }
            ], 'Driving-Point Impedance',
            'Magnitude [dB]', {
                type: 'logarithmic',
                ticks: {
                    callback: function(value, index, values) {
                        // === 1/3 octave label全部表示 ===
                        if (FREQS.includes(value)) return value;
                        return '';
                    },
                    min: 16,
                    max: 8000
                }
            },
            // 追加y軸設定
            {
                y: { type: 'linear', position: 'left', title: { display: true, text: '|Z| dB' } },
                y1: { type: 'linear', position: 'right', grid: { drawOnChartArea: false }, title: { display: true, text: 'Re(Z)' } },
                y2: { type: 'linear', position: 'right', grid: { drawOnChartArea: false }, title: { display: true, text: 'Phase (deg)' } }
            });
    
            // === Table ===
            createTable(ui.impedanceTable, ['Frequency (Hz)', '|Z| dB', 'Re(Z)', 'Phase (deg)'], tableData);
    
            // === Formula表示 ===
            document.getElementById('impedance-formula').innerHTML = `<h5>Driving-Point Impedance Equations</h5>
                <p><b>Magnitude:</b> $$ 20 \\log_{10}|Z_{dp}| $$</p>
                <p><b>Real Part:</b> $$ \\Re\\{Z_{dp}\\} $$</p>
                <p><b>Phase:</b> $$ \\angle Z_{dp} $$ (degrees)</p>`;
            if (window.MathJax) MathJax.typeset();
    
        } catch (e) { alert(e.message); }
    }

   

    function calculateSTL() {
        try {
            const {rho,h,fc}=getCommonInputs();
            const eta = 0.01; // For STL, a constant eta is standard
            const m_dp=rho*h;
            const R_mass=FREQS.map(f=>20*Math.log10(m_dp*f)-42.5);
            const R_coincidence=R_mass.map((r,i)=>{const f=FREQS[i],fr=f/fc;if(Math.abs(fr-1)<1e-6)return r;const c=(2*eta)/(Math.PI*fr)*(1/(1-fr**2)**2);return r-10*Math.log10(Math.abs(c)+1);});
            createPlot('stl-chart',FREQS,[{label:'Mass Law (Normal Incidence)',data:R_mass},{label:'With Coincidence Dip',data:R_coincidence}],'Sound Transmission Loss (STL)','STL (dB)');
            createTable(ui.stlTable,['Frequency (Hz)','Mass Law (dB)','With Coincidence (dB)'],FREQS.map((f,i)=>[f,R_mass[i].toFixed(1),R_coincidence[i].toFixed(1)]));
            document.getElementById('stl-formula').innerHTML=`<h5>Sound Transmission Loss Equations</h5><p><b>Surface Density (m''):</b> $$ m'' = \\rho h $$</p><p><b>Mass Law (Normal Incidence, TL<sub>0</sub>):</b> $$ TL_0 = 20 \\log_{10}(m'' f) - 42.5 \\; (dB) $$</p><p>The coincidence effect is a correction that considers the performance dip around the critical frequency ($f_c$).</p>`;
            if(window.MathJax)MathJax.typeset();
        } catch(e){
            alert(e.message);
        }
    }
    
    function calculateRadiation() {
        try {
            const { h, Lx, Ly, c0, fc } = getCommonInputs();
            const C_BC = 1; // Simply Supported
            const C_OB = parseFloat(ui.baffleCond.value);
            const l = 2 * (Lx + Ly), S = Lx * Ly, lambda_c = c0 / fc, L1 = Math.min(Lx, Ly), L2 = Math.max(Lx, Ly), k_fc = 2 * Math.PI * fc / c0;
            
            const sigma_simple = FREQS.map(f => { let s; if (f > fc) { s = 1.0; } else if (Math.abs(f - fc) < 1e-6) { s = 0.45 * Math.sqrt(l / lambda_c); } else { s = (l * lambda_c / (Math.PI ** 2 * S)) * Math.sqrt(f / fc); } return Math.max(1e-4, Math.min(s, 1.0)); });
            const sigma_leppington = FREQS.map(f => { let s; const mu = Math.sqrt(fc / f); if (f > fc) { s = 1 / Math.sqrt(1 - fc / f); } else if (Math.abs(f - fc) < 1e-6) { s = (0.5 - 0.15 * L1 / L2) * Math.sqrt(k_fc * Math.sqrt(L1)); } else { const k = 2 * Math.PI * f / c0; const mu2_1 = mu ** 2 - 1; if (mu2_1 <= 0 || k <= 0) return 1e-4; const term1 = l / (2 * Math.PI * k * S * Math.sqrt(mu2_1)); const term2 = 2 * Math.atanh(1 / mu); const term3 = 2 * mu / mu2_1; const term4 = C_BC * C_OB - Math.pow(mu, -8) * (C_BC * C_OB - 1); s = term1 * (term2 + term3) * term4; } return Math.max(1e-4, Math.min(s, 1.0)); });
            const sigma_wallace = FREQS.map(f => {
                const k = 2 * Math.PI * f / c0; let sigma_sum = 0;
                for (let p = 1; p <= 5; p++) { for (let q = 1; q <= 5; q++) {
                    let s_pq; const p_odd = p % 2 !== 0, q_odd = q % 2 !== 0;
                    if (p_odd && q_odd) { s_pq = (32*k**2*Lx*Ly/(Math.PI**5*p**2*q**2))*(1-(k**2*Lx*Ly/12)*((1-8/(p*Math.PI)**2)*Lx/Ly+(1-8/(q*Math.PI)**2)*Ly/Lx));
                    } else if (p_odd !== q_odd) {
                        if(p_odd && !q_odd){ s_pq = (8*k**4*Lx**3*Ly/(3*Math.PI**5*p**2*q**2))*(1-(k**2*Lx*Ly/20)*((1-8/(p*Math.PI)**2)*Lx/Ly+(1-24/(q*Math.PI)**2)*Ly/Lx));
                        } else { s_pq = (8*k**4*Ly**3*Lx/(3*Math.PI**5*q**2*p**2))*(1-(k**2*Ly*Lx/20)*((1-8/(q*Math.PI)**2)*Ly/Lx+(1-24/(p*Math.PI)**2)*Lx/Ly)); }
                    } else { s_pq = (2*k**6*Lx**3*Ly**3/(15*Math.PI**5*p**2*q**2))*(1-(5*k**2*Lx**2/64)*((1-24/(p*Math.PI)**2)*Lx/Ly+(1-24/(q*Math.PI)**2)*Ly/Lx)); }
                    sigma_sum += s_pq > 0 ? s_pq : 0;
                }}
                return Math.max(1e-4, Math.min(sigma_sum, 1.0));
            });

            createPlot('rad-chart',FREQS,[{label:'Simple Model',data:sigma_simple},{label:'Leppington',data:sigma_leppington},{label:'Wallace (Modes Sum)',data:sigma_wallace}],'Radiation Efficiency (σ)','Coefficient (σ)', {min:0,max:1.1});
            createTable(ui.radTable,['Frequency (Hz)','σ (Simple)','σ (Leppington)','σ (Wallace)'],FREQS.map((f,i)=>[f,sigma_simple[i].toFixed(3),sigma_leppington[i].toFixed(3), sigma_wallace[i].toExponential(2)]));
            document.getElementById('rad-formula').innerHTML = `<h5>Radiation Efficiency (σ) Equations</h5>
                <p><b>Simple Model (Maidanik Approx.):</b><br><b>f < f<sub>c</sub>:</b> $$\\sigma \\approx \\frac{l \\lambda_c}{\\pi^2 S} \\sqrt{\\frac{f}{f_c}}$$</p><p><b>f = f<sub>c</sub>:</b> $$\\sigma = 0.45 \\sqrt{\\frac{l}{\\lambda_c}}$$</p><p><b>f > f<sub>c</sub>:</b> $$\\sigma = 1$$</p><hr>
                <p><b>Leppington Model:</b><br><b>f < f<sub>c</sub>:</b> $$\\sigma = \\frac{l}{2\\pi k S \\sqrt{\\mu^2-1}} [2\\tanh^{-1}(\\frac{1}{\\mu}) + \\frac{2\\mu}{\\mu^2-1}] \\cdot [C_{BC}C_{OB} - \\mu^{-8}(C_{BC}C_{OB}-1)]$$</p><p><b>f = f<sub>c</sub>:</b> $$\\sigma \\approx (0.5 - \\frac{0.15L_1}{L_2}) \\sqrt{k_{fc}\\sqrt{L_1}}$$</p><p><b>f > f<sub>c</sub>:</b> $$\\sigma = (1 - \\mu^2)^{-0.5}$$</p><hr>
                <p><b>Wallace Model (Sum of Modes):</b><br>$$ \\sigma(f) = \\sum_{p,q} \\sigma_{p,q}(f) $$</p>
                <p><b>Odd-Odd (p,q):</b> $$ \\sigma_{p,q} \\approx \\frac{32k^2L_xL_y}{\\pi^5p^2q^2} \\left\\{1 - \\frac{k^2L_xL_y}{12} \\left[ \\left(1-\\frac{8}{(p\\pi)^2}\\right)\\frac{L_x}{L_y} + \\left(1-\\frac{8}{(q\\pi)^2}\\right)\\frac{L_y}{L_x} \\right] \\right\\} $$</p>
                <p><b>Odd-Even (p,q):</b> $$ \\sigma_{p,q} \\approx \\frac{8k^4L_x^3L_y}{3\\pi^5p^2q^2} \\left\\{1 - \\frac{k^2L_xL_y}{20} \\left[ \\left(1-\\frac{8}{(p\\pi)^2}\\right)\\frac{L_x}{L_y} + \\left(1-\\frac{24}{(q\\pi)^2}\\right)\\frac{L_y}{L_x} \\right] \\right\\} $$</p>
                <p><b>Even-Even (p,q):</b> $$ \\sigma_{p,q} \\approx \\frac{2k^6L_x^3L_y^3}{15\\pi^5p^2q^2} \\left\\{1 - \\frac{5k^2L_x^2}{64} \\left[ \\left(1-\\frac{24}{(p\\pi)^2}\\right)\\frac{L_x}{L_y} + \\left(1-\\frac{24}{(q\\pi)^2}\\right)\\frac{L_y}{L_x} \\right] \\right\\} $$</p>`; 
            if(window.MathJax)MathJax.typeset(); 
        } catch(e){alert(e.message);}
    }

    function onMaterialSelect() { const selectedName = ui.materialSelect.value; const props = MATERIAL_PROPERTIES[selectedName]; const isManual = selectedName === "Custom"; ui.eInput.value = isManual ? "" : props.E.toExponential(2); ui.rhoInput.value = isManual ? "" : props.rho; ui.nuInput.value = isManual ? "" : props.nu;[ui.eInput, ui.rhoInput, ui.nuInput].forEach(input => input.readOnly = false); }
    function openTab(evt, tabName) { document.querySelectorAll('.tab-content').forEach(tab=>tab.classList.remove('active')); document.querySelectorAll('.tab-button').forEach(btn=>btn.classList.remove('active')); document.getElementById(tabName).classList.add('active'); evt.currentTarget.classList.add('active'); }
    function createTable(tableElement, headers, data) { tableElement.innerHTML = `<thead><tr>${headers.map(h => `<th>${h}</th>`).join('')}</tr></thead><tbody>${data.map(row => `<tr>${row.map(cell => `<td>${cell}</td>`).join('')}</tr>`).join('')}</tbody>`; }
    
    function createPlot(chartId, labels, datasets, title, yAxisLabel = 'dB', yAxisOptions = {}) {
        const canvasElement = document.getElementById(chartId);
        if (!canvasElement) return;
        const ctx = canvasElement.getContext('2d');
        if(charts[chartId]) charts[chartId].destroy();
        
        const scales = {
            x: { type: 'logarithmic', title: { display: true, text: 'Frequency (Hz)' }, ticks: { callback: v => THIRD_OCTAVE_TICKS.includes(v) ? v : null } },
            y: { position: 'left', ...yAxisOptions, title: { display: true, text: yAxisLabel } }
        };

        const chart = new Chart(ctx, { type: 'line', data: { labels, datasets: datasets.map((ds) => ({ ...ds, fill: false, borderWidth: 2, pointRadius: 2 })) },
            options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: true, text: title, font: { size: 16 } } }, scales: scales }
        });
        charts[chartId] = chart;
    }
</script>
</body>
</html>
